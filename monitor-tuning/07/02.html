<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>字节码指令简单介绍 | NOTE-BOOK2</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/note-book2/favicon.ico">
    <link rel="manifest" href="/note-book2/manifest.json">
    <meta name="description" content="用来记录学习的笔记，在该笔记仓库中的，则是暂未分类的笔记">
    
    <link rel="preload" href="/note-book2/assets/css/0.styles.36b9479e.css" as="style"><link rel="preload" href="/note-book2/assets/js/app.f16e0c0e.js" as="script"><link rel="preload" href="/note-book2/assets/js/2.b8b48758.js" as="script"><link rel="preload" href="/note-book2/assets/js/87.1322160f.js" as="script"><link rel="preload" href="/note-book2/assets/js/36.71174a9b.js" as="script"><link rel="prefetch" href="/note-book2/assets/js/10.17f16df3.js"><link rel="prefetch" href="/note-book2/assets/js/11.2067d3fd.js"><link rel="prefetch" href="/note-book2/assets/js/12.a5015026.js"><link rel="prefetch" href="/note-book2/assets/js/13.52fd2e19.js"><link rel="prefetch" href="/note-book2/assets/js/14.da92917e.js"><link rel="prefetch" href="/note-book2/assets/js/15.a986f7c1.js"><link rel="prefetch" href="/note-book2/assets/js/16.c7d2aa4c.js"><link rel="prefetch" href="/note-book2/assets/js/17.81b1e372.js"><link rel="prefetch" href="/note-book2/assets/js/18.c9febcf2.js"><link rel="prefetch" href="/note-book2/assets/js/19.8306b312.js"><link rel="prefetch" href="/note-book2/assets/js/20.c58d68f3.js"><link rel="prefetch" href="/note-book2/assets/js/21.5ecd3ae2.js"><link rel="prefetch" href="/note-book2/assets/js/22.e1386ce4.js"><link rel="prefetch" href="/note-book2/assets/js/23.da237ab8.js"><link rel="prefetch" href="/note-book2/assets/js/24.65ea22a2.js"><link rel="prefetch" href="/note-book2/assets/js/25.95db736e.js"><link rel="prefetch" href="/note-book2/assets/js/26.0a22a634.js"><link rel="prefetch" href="/note-book2/assets/js/27.dd70c250.js"><link rel="prefetch" href="/note-book2/assets/js/28.03718595.js"><link rel="prefetch" href="/note-book2/assets/js/29.fbb2b144.js"><link rel="prefetch" href="/note-book2/assets/js/3.65e24944.js"><link rel="prefetch" href="/note-book2/assets/js/30.fce42842.js"><link rel="prefetch" href="/note-book2/assets/js/31.d0bbc0b5.js"><link rel="prefetch" href="/note-book2/assets/js/32.6fd45258.js"><link rel="prefetch" href="/note-book2/assets/js/33.d87cfe9b.js"><link rel="prefetch" href="/note-book2/assets/js/34.7251af2d.js"><link rel="prefetch" href="/note-book2/assets/js/35.22d6475d.js"><link rel="prefetch" href="/note-book2/assets/js/37.9aaecad9.js"><link rel="prefetch" href="/note-book2/assets/js/38.aace0d13.js"><link rel="prefetch" href="/note-book2/assets/js/39.0e143dcd.js"><link rel="prefetch" href="/note-book2/assets/js/4.e72321ef.js"><link rel="prefetch" href="/note-book2/assets/js/40.36824725.js"><link rel="prefetch" href="/note-book2/assets/js/41.c75731de.js"><link rel="prefetch" href="/note-book2/assets/js/42.cdaf663b.js"><link rel="prefetch" href="/note-book2/assets/js/43.102c25b8.js"><link rel="prefetch" href="/note-book2/assets/js/44.c7cc7691.js"><link rel="prefetch" href="/note-book2/assets/js/45.6223a26f.js"><link rel="prefetch" href="/note-book2/assets/js/46.dfba550f.js"><link rel="prefetch" href="/note-book2/assets/js/47.64857b4d.js"><link rel="prefetch" href="/note-book2/assets/js/48.304bbd40.js"><link rel="prefetch" href="/note-book2/assets/js/49.ca88b1a5.js"><link rel="prefetch" href="/note-book2/assets/js/5.f2dcea9e.js"><link rel="prefetch" href="/note-book2/assets/js/50.80a263fa.js"><link rel="prefetch" href="/note-book2/assets/js/51.565016ec.js"><link rel="prefetch" href="/note-book2/assets/js/52.83aa59fb.js"><link rel="prefetch" href="/note-book2/assets/js/53.61ffc7c0.js"><link rel="prefetch" href="/note-book2/assets/js/54.9ce568fe.js"><link rel="prefetch" href="/note-book2/assets/js/55.8794e98d.js"><link rel="prefetch" href="/note-book2/assets/js/56.7c1ab155.js"><link rel="prefetch" href="/note-book2/assets/js/57.d19c493d.js"><link rel="prefetch" href="/note-book2/assets/js/58.ae21d329.js"><link rel="prefetch" href="/note-book2/assets/js/59.8418bddb.js"><link rel="prefetch" href="/note-book2/assets/js/6.2dd57c2d.js"><link rel="prefetch" href="/note-book2/assets/js/60.48a3d812.js"><link rel="prefetch" href="/note-book2/assets/js/61.45c9726d.js"><link rel="prefetch" href="/note-book2/assets/js/62.3f8af685.js"><link rel="prefetch" href="/note-book2/assets/js/63.f4732aad.js"><link rel="prefetch" href="/note-book2/assets/js/64.188a3d26.js"><link rel="prefetch" href="/note-book2/assets/js/65.f3fcc19a.js"><link rel="prefetch" href="/note-book2/assets/js/66.d915a4ca.js"><link rel="prefetch" href="/note-book2/assets/js/67.ef9e086d.js"><link rel="prefetch" href="/note-book2/assets/js/68.f7cbe4bb.js"><link rel="prefetch" href="/note-book2/assets/js/69.2e3864d1.js"><link rel="prefetch" href="/note-book2/assets/js/7.b3b2a10f.js"><link rel="prefetch" href="/note-book2/assets/js/70.ec5a5309.js"><link rel="prefetch" href="/note-book2/assets/js/71.878ed3d7.js"><link rel="prefetch" href="/note-book2/assets/js/72.d6978044.js"><link rel="prefetch" href="/note-book2/assets/js/73.98cccb9c.js"><link rel="prefetch" href="/note-book2/assets/js/74.5825696e.js"><link rel="prefetch" href="/note-book2/assets/js/75.fdf0553a.js"><link rel="prefetch" href="/note-book2/assets/js/76.2fdc5288.js"><link rel="prefetch" href="/note-book2/assets/js/77.b3982a28.js"><link rel="prefetch" href="/note-book2/assets/js/78.62bd4b49.js"><link rel="prefetch" href="/note-book2/assets/js/79.7be3b207.js"><link rel="prefetch" href="/note-book2/assets/js/8.affb7bac.js"><link rel="prefetch" href="/note-book2/assets/js/80.2a6e3c48.js"><link rel="prefetch" href="/note-book2/assets/js/81.0ce596df.js"><link rel="prefetch" href="/note-book2/assets/js/82.f9141f3f.js"><link rel="prefetch" href="/note-book2/assets/js/83.ee3f6645.js"><link rel="prefetch" href="/note-book2/assets/js/84.95ec9984.js"><link rel="prefetch" href="/note-book2/assets/js/85.5bf7531c.js"><link rel="prefetch" href="/note-book2/assets/js/86.57aa98fd.js"><link rel="prefetch" href="/note-book2/assets/js/88.3e39080a.js"><link rel="prefetch" href="/note-book2/assets/js/89.eed49822.js"><link rel="prefetch" href="/note-book2/assets/js/9.36eade97.js"><link rel="prefetch" href="/note-book2/assets/js/90.ca7e52e4.js"><link rel="prefetch" href="/note-book2/assets/js/91.dc63e875.js">
    <link rel="stylesheet" href="/note-book2/assets/css/0.styles.36b9479e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note-book2/" class="home-link router-link-active"><img src="/note-book2/mlogo.svg" alt="NOTE-BOOK2" class="logo"> <span class="site-name can-hide">NOTE-BOOK2</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note-book2/monitor-tuning/" class="nav-link router-link-active">
  JAVA 生产环境下性能监控与调优详解
</a></div><div class="nav-item"><a href="/note-book2/http-protocol/" class="nav-link">
  透视 HTTP 协议
</a></div> <a href="https://github.com/zq99299/note-book2" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note-book2/monitor-tuning/" class="nav-link router-link-active">
  JAVA 生产环境下性能监控与调优详解
</a></div><div class="nav-item"><a href="/note-book2/http-protocol/" class="nav-link">
  透视 HTTP 协议
</a></div> <a href="https://github.com/zq99299/note-book2" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/note-book2/monitor-tuning/" aria-current="page" class="sidebar-link">JAVA 生产环境下性能监控与调优详解</a></li><li><a href="/note-book2/monitor-tuning/00.html" class="sidebar-link">为什么要学习这课程？</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-book2/monitor-tuning/01/" class="sidebar-heading clickable"><span>基于 JDK 命令行工具的监控</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-book2/monitor-tuning/02/" class="sidebar-heading clickable"><span>基于 JVisualVM 的可视化监控</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-book2/monitor-tuning/03/" class="sidebar-heading clickable"><span>基于 Btrace 的监控调试</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-book2/monitor-tuning/04/" class="sidebar-heading clickable"><span>Tomcat 性能监控与调优</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-book2/monitor-tuning/05/" class="sidebar-heading clickable"><span>Nginx 性能监控与调优</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-book2/monitor-tuning/06/" class="sidebar-heading clickable"><span>JVM 层 GC 调优</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/note-book2/monitor-tuning/07/" class="sidebar-heading clickable router-link-active open"><span>Java 代码层优化</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/note-book2/monitor-tuning/07/01.html" class="sidebar-link">JVM 字节码指令与 javap</a></li><li><a href="/note-book2/monitor-tuning/07/02.html" aria-current="page" class="active sidebar-link">字节码指令简单介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note-book2/monitor-tuning/07/02.html#i-与-i" class="sidebar-link">i++ 与 ++i</a></li><li class="sidebar-sub-header"><a href="/note-book2/monitor-tuning/07/02.html#字符串-拼接原理" class="sidebar-link">字符串 + 拼接原理</a></li><li class="sidebar-sub-header"><a href="/note-book2/monitor-tuning/07/02.html#try-finally" class="sidebar-link">Try-Finally</a></li><li class="sidebar-sub-header"><a href="/note-book2/monitor-tuning/07/02.html#string-constant-variable" class="sidebar-link">String Constant Variable</a></li></ul></li><li><a href="/note-book2/monitor-tuning/07/03.html" class="sidebar-link">常用代码优化方法</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="字节码指令简单介绍"><a href="#字节码指令简单介绍" class="header-anchor">#</a> 字节码指令简单介绍</h1> <h2 id="i-与-i"><a href="#i-与-i" class="header-anchor">#</a> i++ 与 ++i</h2> <p>下面来看看这两个操作的字节码是什么样子的</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> ACC_PUBLIC<span class="token punctuation">,</span> ACC_STATIC
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">0</span>
         <span class="token number">0</span><span class="token operator">:</span> iconst_0
         <span class="token number">1</span><span class="token operator">:</span> istore_0
         <span class="token number">2</span><span class="token operator">:</span> iload_0
         <span class="token number">3</span><span class="token operator">:</span> iinc          <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
         <span class="token number">6</span><span class="token operator">:</span> istore_1
         <span class="token number">7</span><span class="token operator">:</span> getstatic     #<span class="token number">2</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
        <span class="token number">10</span><span class="token operator">:</span> iload_1
        <span class="token number">11</span><span class="token operator">:</span> invokevirtual #<span class="token number">3</span>                  <span class="token comment">// Method java/io/PrintStream.println:(I)V</span>
        <span class="token number">14</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">12</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">13</span><span class="token operator">:</span> <span class="token number">2</span>
        line <span class="token number">14</span><span class="token operator">:</span> <span class="token number">7</span>
        line <span class="token number">15</span><span class="token operator">:</span> <span class="token number">14</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">2</span>      <span class="token number">13</span>     <span class="token number">0</span>     i   <span class="token class-name">I</span>
            <span class="token number">7</span>       <span class="token number">8</span>     <span class="token number">1</span>     j   <span class="token class-name">I</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token operator">++</span>i<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> ACC_PUBLIC<span class="token punctuation">,</span> ACC_STATIC
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">0</span>
         <span class="token number">0</span><span class="token operator">:</span> iconst_0
         <span class="token number">1</span><span class="token operator">:</span> istore_0
         <span class="token number">2</span><span class="token operator">:</span> iinc          <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
         <span class="token number">5</span><span class="token operator">:</span> iload_0
         <span class="token number">6</span><span class="token operator">:</span> istore_1
         <span class="token number">7</span><span class="token operator">:</span> getstatic     #<span class="token number">2</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
        <span class="token number">10</span><span class="token operator">:</span> iload_1
        <span class="token number">11</span><span class="token operator">:</span> invokevirtual #<span class="token number">3</span>                  <span class="token comment">// Method java/io/PrintStream.println:(I)V</span>
        <span class="token number">14</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">18</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">19</span><span class="token operator">:</span> <span class="token number">2</span>
        line <span class="token number">20</span><span class="token operator">:</span> <span class="token number">7</span>
        line <span class="token number">21</span><span class="token operator">:</span> <span class="token number">14</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">2</span>      <span class="token number">13</span>     <span class="token number">0</span>     i   <span class="token class-name">I</span>
            <span class="token number">7</span>       <span class="token number">8</span>     <span class="token number">1</span>     j   <span class="token class-name">I</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>精简下信息</p> <p>i++ 对于如下指令</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">;</span>

         <span class="token number">0</span><span class="token operator">:</span> iconst_0
         <span class="token number">1</span><span class="token operator">:</span> istore_0		 <span class="token comment">// 将数值 0 保存在本地变量 0 中</span>
         <span class="token number">2</span><span class="token operator">:</span> iload_0			 <span class="token comment">// 将本地变量 0 压栈，也就是数值 0</span>
         <span class="token number">3</span><span class="token operator">:</span> iinc          <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>  <span class="token comment">// 将本地变量 0 + 1；这里操作的是本地变量，而不是操作数栈</span>
         <span class="token number">6</span><span class="token operator">:</span> istore_1     <span class="token comment">// 将栈顶的结果（数值0）保存在本地变量 1 中</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>++i 对应如下指令</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token operator">++</span>i<span class="token punctuation">;</span>

         <span class="token number">0</span><span class="token operator">:</span> iconst_0
         <span class="token number">1</span><span class="token operator">:</span> istore_0		 <span class="token comment">// 将数值 0 保存在本地变量 0 中</span>
         <span class="token number">2</span><span class="token operator">:</span> iinc          <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>  <span class="token comment">// 将本地变量 0 + 1</span>
         <span class="token number">5</span><span class="token operator">:</span> iload_0			 <span class="token comment">// 将本地变量 0 压栈，这里其实入栈的是相加之后的数值 1 了</span>
         <span class="token number">6</span><span class="token operator">:</span> istore_1		 <span class="token comment">// 将栈顶结果（数值 1）保存在本地变量 1 中</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这里的区别从指令上看出来有不同了，但是还是总结不出来区别是什么。在指令上的区别是：</p> <ul><li><p><code>i++</code>：先将本地变量压栈，再对本地变量 + 1</p> <p>所以说这也是为什么在操作循环中对数组赋值时： <code>arr[i++]</code>，i = 0, 时，操作的是 0，而不是 1 的原因</p></li> <li><p><code>++i</code>：再对本地变量 + 1，再将本地变量压栈，</p></li></ul> <p>所以注意上面的结论和分析流程，因为这两个函数的结果也不一样：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>int i = 0;
int j = i++;  // 打印 j 是 0

int i = 0;
int j = ++i;  // 打印 j 是 1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>带着这个结果再去看指令，就会发现为什么会是 0 了；</p> <ul><li><p><code>int j = i++;</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>2: iload_0			 // 将本地变量 0 压栈，也就是数值 0
3: iinc          0, 1  // 将本地变量 0 + 1；这里操作的是本地变量，而不是操作数栈
6: istore_1     // 将栈顶的结果（数值0）保存在本地变量 1 中
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>2 将数值 0 压栈、3 不是操作数栈，而是操作本地变量表、6 将栈顶结果也就是数值 0 保存到 j 中</p></li> <li><p><code>int j = ++i</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>2: iinc          0, 1  // 将本地变量 0 + 1
5: iload_0			 // 将本地变量 0 压栈，这里其实入栈的是相加之后的数值 1 了
6: istore_1		 // 将栈顶结果（数值 1）保存在本地变量 1 中
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>2 将本地变量0 + 1，再将本地变量 0 压栈（这是入栈的数值是 1），将栈的结果 1 保存到 j 中</p></li></ul> <p>再来看看下面的例子，比较两种写法那种性能高</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> ACC_PUBLIC<span class="token punctuation">,</span> ACC_STATIC
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">0</span>
         <span class="token number">0</span><span class="token operator">:</span> iconst_0
         <span class="token number">1</span><span class="token operator">:</span> istore_0
         <span class="token number">2</span><span class="token operator">:</span> iload_0							<span class="token comment">// 将变量i，也就是本地变量 0 压栈（第一次数值 0）</span>
         <span class="token number">3</span><span class="token operator">:</span> bipush        <span class="token number">10</span>		<span class="token comment">// 把 10 压栈</span>
         <span class="token number">5</span><span class="token operator">:</span> if_icmpge     <span class="token number">21</span>		<span class="token comment">// 如果 1 &gt;= 2,也就是栈里的两个元素，i &gt;= 10 ，就执行 21 这个指令，也就是 return </span>
         <span class="token number">8</span><span class="token operator">:</span> getstatic     #<span class="token number">2</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
        <span class="token number">11</span><span class="token operator">:</span> iload_0						 <span class="token comment">// 本地变量 0 压栈</span>
        <span class="token number">12</span><span class="token operator">:</span> invokevirtual #<span class="token number">3</span>                  <span class="token comment">// Method java/io/PrintStream.println:(I)V</span>
        <span class="token number">15</span><span class="token operator">:</span> iinc          <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>  <span class="token comment">// 将本地变量 0 + 1</span>
        <span class="token number">18</span><span class="token operator">:</span> <span class="token keyword">goto</span>          <span class="token number">2</span>		  <span class="token comment">// 跳转到第 2 条指令，继续执行</span>
        <span class="token number">21</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">24</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">25</span><span class="token operator">:</span> <span class="token number">8</span>
        line <span class="token number">24</span><span class="token operator">:</span> <span class="token number">15</span>
        line <span class="token number">27</span><span class="token operator">:</span> <span class="token number">21</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">2</span>      <span class="token number">19</span>     <span class="token number">0</span>     i   <span class="token class-name">I</span>
      <span class="token class-name">StackMapTable</span><span class="token operator">:</span> number_of_entries <span class="token operator">=</span> <span class="token number">2</span>
        frame_type <span class="token operator">=</span> <span class="token number">252</span> <span class="token comment">/* append */</span>
          offset_delta <span class="token operator">=</span> <span class="token number">2</span>
          locals <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token keyword">int</span> <span class="token punctuation">]</span>
        frame_type <span class="token operator">=</span> <span class="token number">250</span> <span class="token comment">/* chop */</span>
          offset_delta <span class="token operator">=</span> <span class="token number">18</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> ACC_PUBLIC<span class="token punctuation">,</span> ACC_STATIC
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">0</span>
         <span class="token number">0</span><span class="token operator">:</span> iconst_0
         <span class="token number">1</span><span class="token operator">:</span> istore_0
         <span class="token number">2</span><span class="token operator">:</span> iload_0
         <span class="token number">3</span><span class="token operator">:</span> bipush        <span class="token number">10</span>
         <span class="token number">5</span><span class="token operator">:</span> if_icmpge     <span class="token number">21</span>
         <span class="token number">8</span><span class="token operator">:</span> getstatic     #<span class="token number">2</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
        <span class="token number">11</span><span class="token operator">:</span> iload_0
        <span class="token number">12</span><span class="token operator">:</span> invokevirtual #<span class="token number">3</span>                  <span class="token comment">// Method java/io/PrintStream.println:(I)V</span>
        <span class="token number">15</span><span class="token operator">:</span> iinc          <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
        <span class="token number">18</span><span class="token operator">:</span> <span class="token keyword">goto</span>          <span class="token number">2</span>
        <span class="token number">21</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">29</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">30</span><span class="token operator">:</span> <span class="token number">8</span>
        line <span class="token number">29</span><span class="token operator">:</span> <span class="token number">15</span>
        line <span class="token number">32</span><span class="token operator">:</span> <span class="token number">21</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">2</span>      <span class="token number">19</span>     <span class="token number">0</span>     i   <span class="token class-name">I</span>
      <span class="token class-name">StackMapTable</span><span class="token operator">:</span> number_of_entries <span class="token operator">=</span> <span class="token number">2</span>
        frame_type <span class="token operator">=</span> <span class="token number">252</span> <span class="token comment">/* append */</span>
          offset_delta <span class="token operator">=</span> <span class="token number">2</span>
          locals <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token keyword">int</span> <span class="token punctuation">]</span>
        frame_type <span class="token operator">=</span> <span class="token number">250</span> <span class="token comment">/* chop */</span>
          offset_delta <span class="token operator">=</span> <span class="token number">18</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>对于两个方法的输出结果都是 0~9，可以发现两种写法生成的指令都是一样的，他们两个的写法会被优化为一样的，所以他们两种写法性能是一样的。</p> <p>那么这里的 <code>++i</code> 和 <code>i++</code> 被优化成什么了呢？这里是先对本地变量压栈，再对本地变量增加 1，所以是都被优化成了 <code>++i</code></p> <h2 id="字符串-拼接原理"><a href="#字符串-拼接原理" class="header-anchor">#</a> 字符串 <code>+</code> 拼接原理</h2> <p>在循环中做字符串 + 操作</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fun5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            str <span class="token operator">+=</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>用 idea 直接打开 class 文件看到的内容是</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fun5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            str <span class="token operator">=</span> str <span class="token operator">+</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>字节码的内容为</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fun5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> ACC_PUBLIC<span class="token punctuation">,</span> ACC_STATIC
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">0</span>
         <span class="token comment">// 常量压栈，也就是空字符串</span>
         <span class="token number">0</span><span class="token operator">:</span> ldc           #<span class="token number">6</span>                  <span class="token comment">// String</span>
         <span class="token number">2</span><span class="token operator">:</span> astore_0
         <span class="token number">3</span><span class="token operator">:</span> iconst_0
         <span class="token number">4</span><span class="token operator">:</span> istore_1
         <span class="token number">5</span><span class="token operator">:</span> iload_1
         <span class="token number">6</span><span class="token operator">:</span> bipush        <span class="token number">10</span>
         <span class="token number">8</span><span class="token operator">:</span> if_icmpge     <span class="token number">36</span>
        <span class="token number">11</span><span class="token operator">:</span> <span class="token keyword">new</span>           #<span class="token number">7</span>                  <span class="token comment">// class java/lang/StringBuilder</span>
        <span class="token number">14</span><span class="token operator">:</span> dup
        <span class="token number">15</span><span class="token operator">:</span> invokespecial #<span class="token number">8</span>                  <span class="token comment">// Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V</span>
        <span class="token number">18</span><span class="token operator">:</span> aload_0
        <span class="token number">19</span><span class="token operator">:</span> invokevirtual #<span class="token number">9</span>                  <span class="token comment">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>
        <span class="token number">22</span><span class="token operator">:</span> iload_1
        <span class="token number">23</span><span class="token operator">:</span> invokevirtual #<span class="token number">10</span>                 <span class="token comment">// Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</span>
        <span class="token number">26</span><span class="token operator">:</span> invokevirtual #<span class="token number">11</span>                 <span class="token comment">// Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span>
        <span class="token number">29</span><span class="token operator">:</span> astore_0
        <span class="token number">30</span><span class="token operator">:</span> iinc          <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>
        <span class="token number">33</span><span class="token operator">:</span> <span class="token keyword">goto</span>          <span class="token number">5</span>
        <span class="token number">36</span><span class="token operator">:</span> getstatic     #<span class="token number">2</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
        <span class="token number">39</span><span class="token operator">:</span> aload_0
        <span class="token number">40</span><span class="token operator">:</span> invokevirtual #<span class="token number">12</span>                 <span class="token comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
        <span class="token number">43</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">37</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">38</span><span class="token operator">:</span> <span class="token number">3</span>
        line <span class="token number">39</span><span class="token operator">:</span> <span class="token number">11</span>
        line <span class="token number">38</span><span class="token operator">:</span> <span class="token number">30</span>
        line <span class="token number">41</span><span class="token operator">:</span> <span class="token number">36</span>
        line <span class="token number">42</span><span class="token operator">:</span> <span class="token number">43</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">5</span>      <span class="token number">31</span>     <span class="token number">1</span>     i   <span class="token class-name">I</span>
            <span class="token number">3</span>      <span class="token number">41</span>     <span class="token number">0</span>   str   <span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>
      <span class="token class-name">StackMapTable</span><span class="token operator">:</span> number_of_entries <span class="token operator">=</span> <span class="token number">2</span>
        frame_type <span class="token operator">=</span> <span class="token number">253</span> <span class="token comment">/* append */</span>
          offset_delta <span class="token operator">=</span> <span class="token number">5</span>
          locals <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token keyword">class</span> java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token punctuation">]</span>
        frame_type <span class="token operator">=</span> <span class="token number">250</span> <span class="token comment">/* chop */</span>
          offset_delta <span class="token operator">=</span> <span class="token number">30</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>从字节码中可以看到，它在每一次循环中都创建了一个 StringBuilder 来使用 append 方法来相加，最后使用 toString 来得到相加的结果。</p> <h2 id="try-finally"><a href="#try-finally" class="header-anchor">#</a> Try-Finally</h2> <p>看如下一段代码，它的返回值是什么？</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">fun6</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> str<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            str <span class="token operator">=</span> <span class="token string">&quot;mrcode&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>字节码内容</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span> <span class="token function">fun6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>
    flags<span class="token operator">:</span> ACC_PUBLIC<span class="token punctuation">,</span> ACC_STATIC
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">0</span>
         <span class="token comment">// 将常量池中的 #13 常量压栈</span>
         <span class="token number">0</span><span class="token operator">:</span> ldc           #<span class="token number">13</span>                 <span class="token comment">// String hello</span>
         <span class="token number">2</span><span class="token operator">:</span> astore_0  <span class="token comment">// 存储到本地变量表 0</span>
         <span class="token number">3</span><span class="token operator">:</span> aload_0   <span class="token comment">// 本地变量表 0 压栈</span>
         <span class="token number">4</span><span class="token operator">:</span> astore_1	<span class="token comment">// 将结果存储到本地变量表 1</span>
         <span class="token comment">// 这里就是执行 finall 里面的代码了，不过是将 #14 常量压入栈</span>
         <span class="token number">5</span><span class="token operator">:</span> ldc           #<span class="token number">14</span>                 <span class="token comment">// String mrcode</span>
         <span class="token number">7</span><span class="token operator">:</span> astore_0  <span class="token comment">// 然后将结果保存到了本地变量表 0 中，也就是 str = mrcode 这个结果了</span>
         <span class="token number">8</span><span class="token operator">:</span> aload_1  <span class="token comment">// 加载本地变量表 1，也就是 hello</span>
         <span class="token number">9</span><span class="token operator">:</span> areturn  <span class="token comment">// 然后返回了 hello</span>
        <span class="token comment">// 后面的代码是因为 try 的原因，如果说发生异常的话，则会走下面这段代码</span>
        <span class="token number">10</span><span class="token operator">:</span> astore_2 <span class="token comment">// 把异常存储到本地变量 2 中</span>
        <span class="token number">11</span><span class="token operator">:</span> ldc           #<span class="token number">14</span>                 <span class="token comment">// String mrcode</span>
        <span class="token number">13</span><span class="token operator">:</span> astore_0 <span class="token comment">// 将 mrcode 存储在本地变量 1 中</span>
        <span class="token number">14</span><span class="token operator">:</span> aload_2 <span class="token comment">// 加载异常</span>
        <span class="token number">15</span><span class="token operator">:</span> athrow <span class="token comment">// 然后抛出去</span>
      <span class="token class-name">Exception</span> table<span class="token operator">:</span>
         from    <span class="token keyword">to</span>  <span class="token namespace">target</span> type
             <span class="token number">3</span>     <span class="token number">5</span>    <span class="token number">10</span>   any
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">46</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">48</span><span class="token operator">:</span> <span class="token number">3</span>
        line <span class="token number">50</span><span class="token operator">:</span> <span class="token number">5</span>
        line <span class="token number">48</span><span class="token operator">:</span> <span class="token number">8</span>
        line <span class="token number">50</span><span class="token operator">:</span> <span class="token number">10</span>
        line <span class="token number">51</span><span class="token operator">:</span> <span class="token number">14</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">3</span>      <span class="token number">13</span>     <span class="token number">0</span>   str   <span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>
      <span class="token class-name">StackMapTable</span><span class="token operator">:</span> number_of_entries <span class="token operator">=</span> <span class="token number">1</span>
        frame_type <span class="token operator">=</span> <span class="token number">255</span> <span class="token comment">/* full_frame */</span>
          offset_delta <span class="token operator">=</span> <span class="token number">10</span>
          locals <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token keyword">class</span> java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span> <span class="token punctuation">]</span>
          stack <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token keyword">class</span> java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Throwable</span> <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>从字节码看，返回的是变量表 1 的值，但是 finall 里面的字符串相加操作是对变量表 0 相加的。还是先执行的。</p> <p>所以：从字节码来看，无论是否是异常都会走 finally 的代码。</p> <h2 id="string-constant-variable"><a href="#string-constant-variable" class="header-anchor">#</a> String Constant Variable</h2> <p>前面看到的 <code>+</code> 拼接字符串，字节码使用了 StringBuild 来操作，那么是否是所有的 <code>+</code> 操作都会使用 StringBuild 呢？</p> <p>实际上不是的，这个结论就与本次的知识点 <strong>字符串常量变量</strong> 有关</p> <p>看下面的两段代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fun7</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> x <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> y <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> z <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fun8</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> x <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> y <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 唯一的区别是这句代码没有 final</span>
        <span class="token class-name">String</span> z <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>这样看感觉是看不出什么问题，fun7 的字节码指令</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>         <span class="token number">0</span><span class="token operator">:</span> ldc           #<span class="token number">12</span>                 <span class="token comment">// String hello</span>
         <span class="token number">2</span><span class="token operator">:</span> astore_0
         <span class="token comment">// 这里直接将 x + &quot;world&quot; 变成了常量池了，直接压栈</span>
         <span class="token number">3</span><span class="token operator">:</span> ldc           #<span class="token number">14</span>                 <span class="token comment">// String helloworld</span>
         <span class="token number">5</span><span class="token operator">:</span> astore_1
         <span class="token comment">// 同理，这里直接样 x + y 变成了常量池中的常量，直接压栈了</span>
         <span class="token number">6</span><span class="token operator">:</span> ldc           #<span class="token number">15</span>                 <span class="token comment">// String hellohelloworld</span>
         <span class="token number">8</span><span class="token operator">:</span> astore_2
         <span class="token comment">// 后面就是打印结果了</span>
         <span class="token number">9</span><span class="token operator">:</span> getstatic     #<span class="token number">2</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
        <span class="token number">12</span><span class="token operator">:</span> aload_2
        <span class="token number">13</span><span class="token operator">:</span> invokevirtual #<span class="token number">5</span>                  <span class="token comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
        <span class="token number">14</span><span class="token operator">:</span> <span class="token keyword">return</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>fun8 的字节码指令</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>         <span class="token number">0</span><span class="token operator">:</span> ldc           #<span class="token number">12</span>                 <span class="token comment">// String hello</span>
         <span class="token number">2</span><span class="token operator">:</span> astore_0
         <span class="token comment">// 这里直接将 x + &quot;world&quot; 变成了常量池了，直接压栈  </span>
         <span class="token number">3</span><span class="token operator">:</span> ldc           #<span class="token number">14</span>                 <span class="token comment">// String helloworld</span>
         <span class="token number">5</span><span class="token operator">:</span> astore_1
         <span class="token comment">// 从 x+y 开始，就不一样了，new 了 一个 StringBuilder</span>
           <span class="token comment">// 从知识点来看：y 不是一个常量了，是一个变量（因为没有 final）</span>
           <span class="token comment">// x 是常量 + y 变量，变成另外一个变量 z</span>
           <span class="token comment">// 可以看到下面的操作则是，初始化一个 StringBuilder，然后 append(&quot;hello&quot;).append(&quot;helloworld&quot;)</span>
         <span class="token number">6</span><span class="token operator">:</span> <span class="token keyword">new</span>           #<span class="token number">7</span>                  <span class="token comment">// class java/lang/StringBuilder</span>
         <span class="token number">9</span><span class="token operator">:</span> dup
        <span class="token number">10</span><span class="token operator">:</span> invokespecial #<span class="token number">8</span>                  <span class="token comment">// Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V</span>
        <span class="token number">13</span><span class="token operator">:</span> ldc           #<span class="token number">12</span>                 <span class="token comment">// String hello</span>
        <span class="token number">15</span><span class="token operator">:</span> invokevirtual #<span class="token number">9</span>                  <span class="token comment">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>
        <span class="token number">18</span><span class="token operator">:</span> aload_1
        <span class="token number">19</span><span class="token operator">:</span> invokevirtual #<span class="token number">9</span>                  <span class="token comment">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>
        <span class="token number">22</span><span class="token operator">:</span> invokevirtual #<span class="token number">11</span>                 <span class="token comment">// Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span>
        <span class="token number">25</span><span class="token operator">:</span> astore_2
        <span class="token number">26</span><span class="token operator">:</span> getstatic     #<span class="token number">2</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
        <span class="token number">29</span><span class="token operator">:</span> aload_2
        <span class="token number">30</span><span class="token operator">:</span> invokevirtual #<span class="token number">5</span>                  <span class="token comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
        <span class="token number">33</span><span class="token operator">:</span> <span class="token keyword">return</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><blockquote><p>这就是今天的知识点 JAVA 语言规范中的 <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-4.html#jls-4.12.4" target="_blank" rel="noopener noreferrer">Final Variables<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>A <em>constant variable</em> is a <code>final</code> variable of primitive type or type <code>String</code> that is initialized with a constant expression (<a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.28" target="_blank" rel="noopener noreferrer">§15.28<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p> <p>常量变量是 <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.28" target="_blank" rel="noopener noreferrer">常量表达式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 初始化的原始类型或则  final String 类型的</p></blockquote> <p>在常量表达式中，关注下 String 相关的，有一个概念是 <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-3.html#jls-3.10.5" target="_blank" rel="noopener noreferrer">String Literals<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，也就是  <strong>字符串字面量</strong></p> <p>然后下面给了一个例子</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">testPackage</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> lo <span class="token operator">=</span> <span class="token string">&quot;lo&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 相等：因为 hello 变量引用的是常量池里面的， “Hello” 是字面常量，它存储在常量池里面的</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>hello <span class="token operator">==</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 相等：也是常量池中的</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Other</span><span class="token punctuation">.</span>hello <span class="token operator">==</span> hello<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 相等：两个字面常量相加，在编译时替换成字面常量了</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>hello <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token string">&quot;Hel&quot;</span><span class="token operator">+</span><span class="token string">&quot;lo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 不相等: 这里一个字面量 + 一个变量 lo（因为 lo 不是 final 的）,无法发生编译替换了</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>hello <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token string">&quot;Hel&quot;</span><span class="token operator">+</span>lo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 相等：使用了 intern，访问的是常量池里面的字符串</span>
          <span class="token comment">// 简单说：常量池里面没有该字符串，则加入该字符串，有则直接使用</span>
          <span class="token comment">// 但是 jdk 版本不同，它的内存结构也不相同，可能导致有些结果不同版本不相同</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hello <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token string">&quot;Hel&quot;</span><span class="token operator">+</span>lo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Other</span> <span class="token punctuation">{</span> <span class="token keyword">static</span> <span class="token class-name">String</span> hello <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zq99299/note-book2/edit/man/docs/monitor-tuning/07/02.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021-04-02 07:23:40</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note-book2/monitor-tuning/07/01.html" class="prev">
        JVM 字节码指令与 javap
      </a></span> <span class="next"><a href="/note-book2/monitor-tuning/07/03.html">
        常用代码优化方法
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/note-book2/assets/js/app.f16e0c0e.js" defer></script><script src="/note-book2/assets/js/2.b8b48758.js" defer></script><script src="/note-book2/assets/js/87.1322160f.js" defer></script><script src="/note-book2/assets/js/36.71174a9b.js" defer></script>
  </body>
</html>
